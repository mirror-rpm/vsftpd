--- vsftpd-2.3.4/sysutil.c.tout	2011-06-28 23:12:21.134196123 +0530
+++ vsftpd-2.3.4/sysutil.c	2011-06-28 23:48:20.622197105 +0530
@@ -1831,6 +1831,12 @@ vsf_sysutil_connect_timeout(int fd, cons
       {
         die("getsockopt");
       }
+
+      if (retval != 0)
+      {
+        errno = retval;
+	retval = -1;
+      }
     }
   }
   if (wait_seconds > 0)
